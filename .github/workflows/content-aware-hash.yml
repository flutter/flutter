# Copyright 2013 The Flutter Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

name: Generate a content aware hash for the Flutter Engine

on: workflow_dispatch

jobs:
  generate-engine-content-hash:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Generate Hash
        run: |
          # IMPORTANT: Keep the list of files in sync with bin/internal/content_aware_hash.sh
          # We call this directly here as we're expected to be in the merge queue (not master)
          engine_content_hash=$(git ls-tree --format "%(objectname) %(path)" HEAD -- DEPS engine bin/internal/release-candidate-branch.version | git hash-object --stdin)
          # test notice annotation for retrival from api
          echo "::notice ::{\"engine_content_hash\": \"${engine_content_hash}\"}"
          # test summary writing
          echo "{\"engine_content_hash\": \"${engine_content_hash}\"" >> $GITHUB_STEP_SUMMARY
