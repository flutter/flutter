# Describes the targets run in continuous integration environment.
#
# Flutter infra uses this file to generate a checklist of tasks to be performed
# for every commit.
#
# The recipes mentioned below refer to those in this repo:
#   https://flutter.googlesource.com/recipes/+/refs/heads/main/recipes/
#
# The "flutter_drone" recipe just defers to dev/bots/test.dart in this repo,
# with the shard set according to the "shard" key in this file.
#
# More information at:
#  * https://github.com/flutter/cocoon/blob/main/CI_YAML.md
enabled_branches:
  - master
  - flutter-\d+\.\d+-candidate\.\d+

platform_properties:
  staging_build_linux:
    properties:
      dependencies: >-
        [
          {"dependency": "curl", "version": "version:7.64.0"}
        ]
      os: Ubuntu
      cores: "8"
      device_type: none
      ignore_flakiness: "true"
  linux:
    properties:
      dependencies: >-
        [
          {"dependency": "curl", "version": "version:7.64.0"}
        ]
      os: Ubuntu
      cores: "8"
      device_type: none
  # The current android emulator config names can be found here:
  # https://chromium.googlesource.com/chromium/src.git/+/HEAD/tools/android/avd/proto
  # You may use those names for the android_virtual_device version. You may find the
  # avd_cipd_version by clicking on the latest available instance and looking for the
  # build_id:<Identifier#> here:
  # https://chrome-infra-packages.appspot.com/p/chromium/tools/android/avd/linux-amd64.
  linux_android_emu:
    properties:
      contexts: >-
        [
          "android_virtual_device"
        ]
      dependencies: >-
        [
          {"dependency": "android_sdk", "version": "version:36v1"},
          {"dependency": "android_virtual_device", "version": "android_35_google_apis_x64.textpb"},
          {"dependency": "avd_cipd_version", "version": "build_id:8733065022087935185"},
          {"dependency": "open_jdk", "version": "version:21"}
        ]
      os: Ubuntu
      cores: "8"
      device_type: none
      kvm: "1"
  # linux_android_emu_unstable is intended to be how flutter-android proves the stability
  # of new combinations of dependencies.
  linux_android_emu_unstable:
    properties:
      contexts: >-
        [
          "android_virtual_device"
        ]
      dependencies: >-
        [
          {"dependency": "android_sdk", "version": "version:36v1"},
          {"dependency": "android_virtual_device", "version": "android_36_google_apis_x64.textpb"},
          {"dependency": "avd_cipd_version", "version": "build_id:8719362231152674241"},
          {"dependency": "open_jdk", "version": "version:21"}
        ]
      os: Ubuntu
      cores: "8"
      device_type: none
      kvm: "1"
  linux_build_test:
    properties:
      dependencies: >-
        [
          {"dependency": "android_sdk", "version": "version:36v1"},
          {"dependency": "open_jdk", "version": "version:21"},
          {"dependency": "curl", "version": "version:7.64.0"}
        ]
      os: Ubuntu
      cores: "8"
      device_type: none
  linux_android:
    properties:
      dependencies: >-
        [
          {"dependency": "android_sdk", "version": "version:36v1"},
          {"dependency": "open_jdk", "version": "version:21"},
          {"dependency": "curl", "version": "version:7.64.0"}
        ]
      os: Linux
      device_type: "msm8952"

  linux_pixel_7pro:
    properties:
      dependencies: >-
        [
          {"dependency": "android_sdk", "version": "version:36v1"},
          {"dependency": "open_jdk", "version": "version:21"},
          {"dependency": "curl", "version": "version:7.64.0"}
        ]
      os: Linux
      device_type: "Pixel 7 Pro"

  linux_mokey:
    properties:
      dependencies: >-
        [
          {"dependency": "android_sdk", "version": "version:36v1"},
          {"dependency": "open_jdk", "version": "version:21"},
          {"dependency": "curl", "version": "version:7.64.0"}
        ]
      os: Linux
      device_type: "mokey"

  linux_galaxy_s24:
    properties:
      dependencies: >-
        [
          {"dependency": "android_sdk", "version": "version:36v1"},
          {"dependency": "open_jdk", "version": "version:21"},
          {"dependency": "curl", "version": "version:7.64.0"}
        ]
      os: Linux
      device_type: "SM-S921U1"

  mac:
    properties:
      contexts: >-
        [
          "osx_sdk"
        ]
      dependencies: >-
        [
          {"dependency": "apple_signing", "version": "version:to_2025"}
        ]
      os: Mac-14|Mac-15.5
      device_type: none
      $flutter/osx_sdk : >-
        {
          "sdk_version": "16c5032a"
        }
  mac_arm64:
    properties:
      contexts: >-
        [
          "osx_sdk"
        ]
      dependencies: >-
        [
          {"dependency": "apple_signing", "version": "version:to_2025"}
        ]
      os: Mac-14|Mac-15.5
      device_type: none
      cpu: arm64
      $flutter/osx_sdk : >-
        {
          "sdk_version": "16c5032a"
        }
  mac_benchmark:
    properties:
      contexts: >-
        [
          "osx_sdk"
        ]
      dependencies: >-
        [
          {"dependency": "apple_signing", "version": "version:to_2025"}
        ]
      device_type: none
      mac_model: "Macmini8,1"
      os: Mac-14|Mac-15.5
      tags: >
        ["devicelab", "hostonly", "mac"]
      $flutter/osx_sdk : >-
        {
          "sdk_version": "16c5032a"
        }
  mac_x64:
    properties:
      contexts: >-
        [
          "osx_sdk"
        ]
      dependencies: >-
        [
          {"dependency": "apple_signing", "version": "version:to_2025"}
        ]
      os: Mac-14|Mac-15.5
      device_type: none
      cpu: x86
      $flutter/osx_sdk : >-
        {
          "sdk_version": "16c5032a"
        }
  mac_build_test:
    properties:
      contexts: >-
        [
          "osx_sdk"
        ]
      dependencies: >-
        [
          {"dependency": "ruby", "version": "ruby_3.1-pod_1.13"},
          {"dependency": "apple_signing", "version": "version:to_2025"}
        ]
      os: Mac-14|Mac-15.5
      device_type: none
      cpu: x86
      $flutter/osx_sdk : >-
        {
          "sdk_version": "16c5032a"
        }
  mac_android:
    properties:
      dependencies: >-
        [
          {"dependency": "android_sdk", "version": "version:36v1"},
          {"dependency": "chrome_and_driver", "version": "version:125.0.6422.141"},
          {"dependency": "open_jdk", "version": "version:21"}
        ]
      os: Mac-14|Mac-15.5
      cpu: x86
      device_type: "msm8952"
  mac_arm64_android:
    properties:
      dependencies: >-
        [
          {"dependency": "android_sdk", "version": "version:36v1"},
          {"dependency": "open_jdk", "version": "version:21"}
        ]
      os: Mac-14|Mac-15.5
      cpu: arm64
      device_type: "msm8952"

  mac_mokey:
    properties:
      dependencies: >-
        [
          {"dependency": "android_sdk", "version": "version:36v1"},
          {"dependency": "chrome_and_driver", "version": "version:125.0.6422.141"},
          {"dependency": "open_jdk", "version": "version:21"}
        ]
      os: Mac-14|Mac-15.5
      cpu: x86
      device_type: "mokey"
  mac_arm64_mokey:
    properties:
      dependencies: >-
        [
          {"dependency": "android_sdk", "version": "version:36v1"},
          {"dependency": "open_jdk", "version": "version:21"}
        ]
      os: Mac-14|Mac-15.5
      cpu: arm64
      device_type: "mokey"

  mac_pixel_7pro:
    properties:
      dependencies: >-
        [
          {"dependency": "android_sdk", "version": "version:36v1"},
          {"dependency": "open_jdk", "version": "version:21"}
        ]
      os: Mac-14|Mac-15.5
      cpu: x86
      device_type: "Pixel 7 Pro"
  mac_ios:
    properties:
      contexts: >-
        [
          "osx_sdk_devicelab"
        ]
      dependencies: >-
        [
          {"dependency": "ruby", "version": "ruby_3.1-pod_1.13"},
          {"dependency": "apple_signing", "version": "version:to_2025"}
        ]
      os: Mac-14|Mac-15.1|Mac-15.5
      device_os: iOS-17|iOS-18
      $flutter/osx_sdk : >-
        {
          "sdk_version": "16c5032a"
        }
  mac_x64_ios:
    properties:
      contexts: >-
        [
          "osx_sdk_devicelab"
        ]
      dependencies: >-
        [
          {"dependency": "ruby", "version": "ruby_3.1-pod_1.13"},
          {"dependency": "apple_signing", "version": "version:to_2025"}
        ]
      os: Mac-14|Mac-15.1|Mac-15.5
      cpu: x86
      device_os: iOS-17|iOS-18
      $flutter/osx_sdk : >-
        {
          "sdk_version": "16c5032a"
        }
  mac_arm64_ios:
    properties:
      contexts: >-
        [
          "osx_sdk_devicelab"
        ]
      dependencies: >-
        [
          {"dependency": "ruby", "version": "ruby_3.1-pod_1.13"},
          {"dependency": "apple_signing", "version": "none"}
        ]
      os: Mac-14|Mac-15.1|Mac-15.5
      cpu: arm64
      device_os: iOS-17|iOS-18
      $flutter/osx_sdk : >-
        {
          "sdk_version": "16c5032a"
        }
  windows:
    properties:
      os: Windows-10
      device_type: none
  windows_arm64:
    properties:
      # The arch can be removed after https://github.com/flutter/flutter/issues/135722.
      arch: arm
      os: Windows
      cpu: arm64
  windows_android:
    properties:
      dependencies: >-
        [
          {"dependency": "android_sdk", "version": "version:36v1"},
          {"dependency": "chrome_and_driver", "version": "version:125.0.6422.141"},
          {"dependency": "open_jdk", "version": "version:21"}
        ]
      os: Windows-10
      device_type: "msm8952"
  windows_mokey:
    properties:
      dependencies: >-
        [
          {"dependency": "android_sdk", "version": "version:36v1"},
          {"dependency": "chrome_and_driver", "version": "version:125.0.6422.141"},
          {"dependency": "open_jdk", "version": "version:21"}
        ]
      os: Windows-10
      device_type: "mokey"

targets:
  - name: Linux web_tool_tests
    recipe: flutter/flutter_drone
    # bringup: true # Flaky https://github.com/flutter/flutter/issues/169574
    timeout: 90 # https://github.com/flutter/flutter/issues/169634
    properties:
      dependencies: >-
        [
          {"dependency": "android_sdk", "version": "version:36v1"},
          {"dependency": "chrome_and_driver", "version": "version:125.0.6422.141"},
          {"dependency": "open_jdk", "version": "version:21"},
          {"dependency": "goldctl", "version": "git_revision:2387d6fff449587eecbb7e45b2692ca0710b63b9"}
        ]
      shard: web_tool_tests
      subshard: "1_1"
      tags: >
        ["framework", "hostonly", "shard", "linux"]
      # Retry for flakes caused by https://github.com/flutter/flutter/issues/132654
      presubmit_max_attempts: "2"
      test_timeout_secs: "5400" # https://github.com/flutter/flutter/issues/162714
    runIf:
      - dev/**
      - packages/flutter_tools/**
      - bin/**
      - .ci.yaml
      - engine/**
      - DEPS

  - name: Mac web_tool_tests
    recipe: flutter/flutter_drone
    timeout: 60
    properties:
      dependencies: >-
        [
          {"dependency": "android_sdk", "version": "version:36v1"},
          {"dependency": "chrome_and_driver", "version": "version:125.0.6422.141"},
          {"dependency": "open_jdk", "version": "version:21"},
          {"dependency": "goldctl", "version": "git_revision:2387d6fff449587eecbb7e45b2692ca0710b63b9"}
        ]
      shard: web_tool_tests
      subshard: "1_1"
      tags: >
        ["framework", "hostonly", "shard", "mac"]
      test_timeout_secs: "3600" # 60 minutes to match the global `timeout` property.
    runIf:
      - dev/**
      - packages/flutter_tools/**
      - bin/**
      - .ci.yaml
      - engine/**
      - DEPS

  - name: Windows web_tool_tests_1_2
    recipe: flutter/flutter_drone
    timeout: 60
    properties:
      dependencies: >-
        [
          {"dependency": "android_sdk", "version": "version:36v1"},
          {"dependency": "chrome_and_driver", "version": "version:125.0.6422.141"},
          {"dependency": "open_jdk", "version": "version:21"},
          {"dependency": "goldctl", "version": "git_revision:2387d6fff449587eecbb7e45b2692ca0710b63b9"}
        ]
      shard: web_tool_tests
      subshard: "1_2"
      tags: >
        ["framework", "hostonly", "shard", "windows"]
      test_timeout_secs: "3600" # 60 minutes to match the global `timeout` property.
    runIf:
      - dev/**
      - packages/flutter_tools/**
      - bin/**
      - .ci.yaml
      - engine/**
      - DEPS

  - name: Windows web_tool_tests_2_2
    recipe: flutter/flutter_drone
    timeout: 60
    properties:
      dependencies: >-
        [
          {"dependency": "android_sdk", "version": "version:36v1"},
          {"dependency": "chrome_and_driver", "version": "version:125.0.6422.141"},
          {"dependency": "open_jdk", "version": "version:21"},
          {"dependency": "goldctl", "version": "git_revision:2387d6fff449587eecbb7e45b2692ca0710b63b9"}
        ]
      shard: web_tool_tests
      subshard: "2_2"
      tags: >
        ["framework", "hostonly", "shard"]
    runIf:
    - dev/**
    - packages/flutter_tools/**
    - bin/**
    - .ci.yaml
    - engine/**
    - DEPS
